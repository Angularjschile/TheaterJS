!function(e,t){function n(e){var t=this,n={autoplay:!0,erase:!0};t.events={},t.scene=-1,t.scenario=[],t.options=t.utils.merge(n,e||{}),t.casting={},t.current={},t.state="ready"}n.prototype={constructor:n,set:function(e,t){var n=this;switch(n.current.model=e,n.current.type){case"title":n.current.voice=e;break;case"function":n.current.voice.apply(n,t);break;default:n.current.voice.innerHTML=e}return n},getSayingSpeed:function(e){var t=this,n=e?t.current.experience:t.utils.randomFloat(t.current.experience,1);return t.utils.getPercentageBetween(600,50,n)},isMistaking:function(){var e=this;return e.utils.randomFloat(0,.8)>e.current.experience},utils:{merge:function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e},getPercentageBetween:function(e,t,n){return e-e*n+t*n},randomChar:function(){var e=this,t="abcdefghijklmnopqrstuvwxyz";return t.charAt(e.randomNumber(0,t.length-1))},randomNumber:function(e,t){return Math.floor(Math.random()*(t-e+1))+e},randomFloat:function(e,t){return Math.round(10*(Math.random()*(t-e)+e))/10},hasClass:function(e,t){return e.classList?e.classList.contains(t):new RegExp("(^| )"+t+"( |$)","gi").test(e.className)},addClass:function(e,t){e.classList?e.classList.add(t):e.className+=" "+t},removeClass:function(e,t){e.classList?e.classList.remove(t):e.className=e.className.replace(new RegExp("(^|\\b)"+t.split(" ").join("|")+"(\\b|$)","gi")," ")}},train:function(e){var t=this,n={experience:.6,voice:function(){console.log(this.model)},type:"function",model:""};return t.utils.merge(n,e)},describe:function(e,n,r){if("string"!=typeof e)throw"actor's name has wrong type: "+typeof e;var a=this,i={name:e};return void 0!==n&&(i.experience=n),void 0!==r&&(i.type=r===t.title?"title":"function"==typeof r?"function":"DOM",i.voice="DOM"===i.type&&"string"==typeof r?t.querySelector(r):r),a.casting[e]=a.train(i),a},write:function(){for(var e,t=this,n=Array.prototype.splice.apply(arguments,[0]),r=0,a=n.length;a>r;r++)if(e=n[r],"string"==typeof e){var i=e.split(":"),s=i.length>1,o=s?i[0].trim():null,c=s?i[1].trim():i[0].trim();s&&t.write({name:"actor",args:[o]}),t.options.erase&&s&&t.write({name:"erase"}),t.write({name:"say",args:[c,!s]})}else"number"==typeof e?t.write(0>e?{name:"erase",args:[e]}:{name:"wait",args:[e]}):"function"==typeof e?t.write({name:"call",args:[e]}):e instanceof Object&&t.scenario.push(e);return t.options.autoplay&&t.play(),t},play:function(e){var t=this;return e===!0&&(t.scene=-1),"ready"===t.state&&t.next(),t},on:function(e,t){var n=this;e=e.split(",");for(var r,a=0,i=e.length;i>a;a++)r=e[a]=e[a].trim(),(n.events[r]||(n.events[r]=[])).push(t);return n},emit:function(e,t,n){if("string"!=typeof e)throw"emit: scope missing";"string"!=typeof t?t=void 0:void 0!==t&&void 0===n&&(n=t);var r=this,a=e+(t?":"+t:""),i=r.events[a]||[];n instanceof Array||(n=[n]);for(var s=0,o=i.length;o>s;s++)i[s].apply(r,n);return r},call:function(e,t){var n=this;return e.apply(n),t?n:n.next()},next:function(){var e=this,t=e.scenario[e.scene];if(t&&e.emit(t.name,"end",[t.name].concat(t.args)),e.scene+1>=e.scenario.length)e.state="ready";else{e.state="playing";var n=e.scenario[++e.scene];e.emit(n.name,"start",[n.name].concat(n.args)),e[n.name].apply(e,n.args)}return e},actor:function(e){var t=this;return t.current=t.casting[e],t.next()},say:function(e,t){var n=this,r=-1,a=t?n.current.model:n.current.model="",i=setTimeout(function s(){var t=a.charAt(r)||null,o=e.charAt(++r),c=a+=o;n.set(c,[c,o,t,e]),r<e.length?i=setTimeout(s,n.getSayingSpeed()):n.next()},n.getSayingSpeed());return n},erase:function(e){var t=this,n="string"==typeof t.current.model?t.current.model.length:-1,r="number"==typeof e&&0>e?n+1+e:0;if(0>n)return t.next();setTimeout(function a(){var e=t.current.model.charAt(n),i=t.current.model.substr(0,--n);t.set(i,[i,null,e,i]),n>=r?setTimeout(a,t.getSayingSpeed(!0)):t.next()},t.getSayingSpeed(!0));return t},wait:function(e){var t=this;return setTimeout(function(){t.next()},e),t}},e.TheaterJS=n}(window,document);